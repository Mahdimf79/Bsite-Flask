<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Home</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='index.css') }}">
  </head>
    <body>
      <div id="erroralert" class="erroralert">
        <p id="error"></p>
      </div>
      <header>
        {% if user != None %}
          <h1>Hi, {{ user }}</h1>
          <div>
              <a href="http://127.0.0.1:5000/logout">
                <button type="button" name="button">Logout</button>
              </a>
              <a href="http://127.0.0.1:5000/forecast">
                <button type="button" name="button">Forecast</button>
              </a>
          </div>
        {% else %}
          <h1>Welcome To EverliceBet</h1>

          <div>
              <a href="http://127.0.0.1:5000/login">
                <button type="button" name="button">Login</button>
              </a>
              <a href="http://127.0.0.1:5000/register">
                <button type="button" name="button">Register</button>
              </a>
          </div>
        {% endif %}
    </header>
    {% if forecast %}
      {% for cast in forecast %}
        <div style="color:white;">
          <p><span>Coin : </span>{{ cast['coin'] }}</p>
          <p><span>Guess : </span>{{ cast['guess'] }}</p>
          <p><span>Date : </span>{{ cast['date'] }}</p>
          <p><span>Money : </span>{{ cast['money'] }}</p>
          <button type="button" name="button" id="{{ cast['id'] }}" onclick="handleSubmit(this.id)">Participation</button>
        </div>
      {% endfor %}
    {% endif %}



  {% block javascript %}
    <script>

      const error = document.getElementById('error');

      function handleSubmit(id) {

        fetch('http://127.0.0.1:5000/participation/set',{
           method: 'POST',
           headers: { 'Content-Type': 'application/x-www-form-urlencoded',
             "X-CSRFToken": '{{csrf_token}}',
           },
           body: `idcast=${id}`
        })
        .then(response => response.json())
        .then(data => {
          if(data.ok){
            error.innerHTML = data.status;
          }else{
            error.innerHTML = data.status;
          }
        });

      }

    </script>
  {% endblock javascript %}
  </body>
</html>
